<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Dashboard - Dark-Love-MD</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
<header>
    <div class="logo">Dark-Love-MD</div>
    <nav>
        <a href="dashboard.html" class="active">Dashboard</a>
        <a href="upload.html">Upload</a>
        <a href="#">Services</a>
        <a href="#">Policy</a>
        <a href="https://t.me/DarkLoveMD">Channel</a>
        <span id="welcomeUser"></span>
        <span id="themeToggle" class="theme-btn">ðŸŒž</span>
    </nav>
</header>

<div class="search-bar">
    <input type="text" id="search" placeholder="Search for a bot...">
    <button onclick="loadBots()">Search</button>
</div>

<div id="botsContainer"></div>

<script>
const token = localStorage.getItem('token');
if (!token) window.location.href = 'index.html';

document.getElementById('welcomeUser').innerText = 'Welcome ' + localStorage.getItem('username');

async function loadBots() {
    const searchValue = document.getElementById('search').value;
    const res = await fetch(`/bots?search=${encodeURIComponent(searchValue)}`);
    const bots = await res.json();
    const container = document.getElementById('botsContainer');
    container.innerHTML = '';
    bots.forEach(bot => {
        container.innerHTML += `
            <div class="bot-card">
                <img src="${bot.logoUrl}" alt="logo">
                <h3>${bot.name}</h3>
                <p>${bot.description || ''}</p>
                <a href="${bot.repoUrl}" target="_blank">View Repo</a>
                <button onclick="deleteBot('${bot._id}')">Delete</button>
            </div>
        `;
    });
}

async function deleteBot(botId) {
    const password = prompt('Enter your password to delete this bot:');
    const res = await fetch('/delete', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify({ botId, password })
    });
    const data = await res.json();
    alert(data.message);
    loadBots();
}

document.getElementById('themeToggle').addEventListener('click', () => {
    document.body.classList.toggle('dark');
    document.getElementById('themeToggle').innerText = document.body.classList.contains('dark') ? 'ðŸŒ™' : 'ðŸŒž';
});

loadBots();
</script>
</body>
</html>
